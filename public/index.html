<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NIGHTHUB - Talk to Strangers</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="waiting-room.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
</head>
<body>
    <div id="ambient-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="noise-overlay"></div>
    </div>

    <div class="app-container">
        <!-- iOS Style Status Bar -->
        <header class="status-bar">
            <div class="time" id="status-time">00:00</div>
            <div class="logo-pill">NIGHTHUB</div>
            <div class="status-indicators">
                <span id="header-status" class="online-pill">... Online</span>
            </div>
        </header>

        <main id="main-content">
            <!-- TAB 1: RANDOM CHAT (HOME) -->
            <section id="tab-random" class="tab-view active">
                <div id="random-intro" class="view-state active">
                    <div class="hero-section">
                        <h1>Talk to<br>someone new.</h1>
                        <p>One tap to connect with a stranger anywhere in the world.</p>
                    </div>
                    
                    <!-- Interest Section -->
                    <div class="interest-input-container">
                        <label for="interest-tags">What are you into?</label>
                        <input type="text" id="interest-tags" class="glass-input-lg" placeholder="e.g. anime, music, venting (optional)">
                    </div>

                    <div class="connect-trigger-container">
                        <div class="radar-emitter">
                            <div class="radar-wave w1"></div>
                            <div class="radar-wave w2"></div>
                            <div class="radar-wave w3"></div>
                        </div>
                        <button id="start-random-btn" class="connect-main-btn">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                            <span>Start Chat</span>
                        </button>
                    </div>

                    <div class="quick-stats">
                        <div class="stat-pill">
                            <span class="stat-dot secure"></span>
                            <span>End-to-End Encrypted</span>
                        </div>
                        <div class="stat-pill">
                            <span class="stat-dot anon"></span>
                            <span>Fully Anonymous</span>
                        </div>
                    </div>
                </div>
                
                <div id="random-chat-interface" class="view-state hidden">
                    <!-- Searching Overlay -->
                    <div id="searching-overlay" class="searching-overlay hidden">
                        <div class="circles-container">
                            <div class="pulse-circle c1"></div>
                            <div class="pulse-circle c2"></div>
                            <div class="pulse-circle c3"></div>
                        </div>
                        <h2 class="searching-text">Looking for someone...</h2>
                        <button id="cancel-search-btn" class="action-capsule-btn danger-outline">Stop</button>
                    </div>

                    <div class="chat-header glass-panel">
                        <div class="user-meta">
                            <div class="avatar-placeholder">?</div>
                            <div class="user-info">
                                <h3 id="random-header-info">Anonymous User</h3>
                                <span class="status-text">Connected</span>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button id="video-call-btn" class="icon-btn" title="Video Call">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                            </button>
                            <button id="audio-call-btn" class="icon-btn" title="Audio Call">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                            </button>
                            <button id="report-btn" class="icon-btn warning" title="Report">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            </button>
                            <button id="stop-random-btn" class="action-capsule-btn danger-outline">
                                <span>Stop</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                            </button>
                            <button id="next-random-btn-header" class="action-capsule-btn">
                                <span>Next</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                            </button>
                        </div>
                    </div>
                
                    <!-- Searching Pulse Overlay -->
                    <div id="searching-overlay" class="hidden">
                        <div class="pulse-ring"></div>
                        <p style="margin-top: 20px; font-weight: 500;">Searching for a stranger...</p>
                    </div>

                    <!-- Waiting Room Overlay -->
                    <div id="waiting-room-overlay" class="hidden">
                        <div class="waiting-header">
                            <h2>Taking a while...</h2>
                            <p>Here‚Äôs something to pass the time:</p>
                        </div>
                        <div class="activity-container">
                            <div id="waiting-room-activity" class="activity-card">
                                <!-- Dynamic Activity Content -->
                                "Did you know honey never spoils? Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly edible."
                            </div>
                            <button id="refresh-activity-btn" class="modal-btn secondary">Wait for match...</button>
                        </div>
                        
                        <!-- Match Found Prompt (Hidden initially) -->
                        <div id="match-found-modal" class="match-found-modal hidden">
                            <h3 style="text-align:center;">Match Found!</h3>
                            <button id="join-chat-btn" class="modal-btn accent">Join Chat</button>
                            <button id="skip-chat-btn" class="modal-btn secondary">Skip & Keep Waiting</button>
                        </div>
                    </div>
                    
                    
                    <div id="random-messages" class="messages-scroll-area">
                        <div class="system-message">
                            <span class="sys-icon">üîí</span>
                            <span>Messages are end-to-end encrypted.</span>
                        </div>
                    </div>
                    
                    <div class="input-area glass-panel-bottom">
                        <!-- Removed skip button from bottom -->
                        <form id="random-chat-form" class="message-bar">
                             <button type="button" id="media-btn" class="icon-btn small" title="Share Image/Video">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            </button>
                            <!-- Magic Wand / Activities Button -->
                            <button type="button" id="activity-btn" class="icon-btn small" title="Games & Icebreakers">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                            </button>
                            <input type="text" id="random-input" placeholder="Type a message..." autocomplete="off">
                            <button type="submit" id="random-send-btn" class="send-fab">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- ACTIVITIES MENU OVERLAY -->
            <div id="activity-menu" class="modal-overlay hidden">
                <div class="modal-card glass-card">
                    <h3>Fun & Games</h3>
                    <div class="grid-menu">
                        <button class="menu-item-btn" id="btn-ask-icebreaker">
                            <span class="emoji">üßä</span>
                            <span>Icebreaker</span>
                        </button>
                        <button class="menu-item-btn" id="btn-start-rps">
                            <span class="emoji">‚úÇÔ∏è</span>
                            <span>Rock Paper Scissors</span>
                        </button>
                    </div>
                    <button id="close-activity-menu" class="modal-btn secondary" style="margin-top:20px">Cancel</button>
                </div>
            </div>

            <!-- TAB 2: ENTERTAINMENT (WATCH) -->
            <section id="tab-watch" class="tab-view hidden">
                <!-- Channel Selector / Lobby -->
                <div id="watch-lobby" class="view-state active">

                    <nav class="tv-nav-bar">
                        <!-- Brand removed as requested -->
                        <!-- Categories / Filter -->
                        <div id="category-scroller" class="tv-categories">
                            <span class="category-pill active" data-filter="all">All Channels</span>
                            <span class="category-pill" data-filter="news">News</span>
                            <span class="category-pill" data-filter="movie">Movies</span>
                            <span class="category-pill" data-filter="sport">Sports</span>
                            <span class="category-pill" data-filter="music">Music</span>
                            <span class="category-pill" data-filter="kids">Kids</span>
                            <span class="category-pill" data-filter="doc">Documentary</span>
                        </div>
                        
                        <div class="tv-actions">
                            <!-- Search Toggle Button -->
                            <button id="search-toggle-btn" class="tv-icon-btn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </button>
                            <!-- Collapsible Search Container -->
                            <div id="search-container-wrapper" class="search-wrapper hidden">
                                <div class="search-container">
                                    <input type="text" id="channel-search" class="tv-search-input" placeholder="Search channels...">
                                </div>
                            </div>
                        </div>
                    </nav>
                    <div id="channel-list" class="scroll-list">
                        <!-- Channels injected by JS -->
                    </div>
                </div>

                <!-- Player Interface -->
                <div id="watch-interface" class="view-state hidden">
                    <div class="video-container">
                        <video id="iptv-player" controls playsinline></video>
                        
                        <div class="video-overlays">
                            <button id="back-to-channels" class="overlay-btn" title="Back">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="15 18 9 12 15 6"></polyline></svg>
                            </button>
                            
                            <div class="overlay-title-group">
                                <h3 id="channel-name-display">Channel Name</h3>
                                <span class="live-badge">LIVE</span>
                            </div>

                        </div>
                    </div>
                    
                    <div id="live-chat-panel" class="chat-overlay hidden" style="display: none !important;">
                        <div class="chat-header glass-panel condensed">
                             <span>Chat Disabled</span>
                             <button id="close-chat-btn" class="icon-btn small"><svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                        </div>
                        
                        <div id="group-messages" class="messages-scroll-area compact-chat"></div>
                        
                        <div class="input-area glass-panel-bottom">
                            <!-- Removed -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Floating Tab Bar -->
        <div class="floating-nav-container">
            <nav class="glass-tab-bar floating-curve">
                <button class="tab-btn active" data-tab="random">
                    <div class="tab-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M2 12h20"></path><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                    </div>
                    <span>Connect</span>
                </button>
                <button class="tab-btn" data-tab="watch">
                    <div class="tab-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>
                    </div>
                    <span>Watch</span>
                </button>
            </nav>
        </div>

        <!-- Modals -->
        <div id="create-group-modal" class="modal-overlay hidden" style="display:none">
            <!-- Legacy removed -->
        </div>



        <!-- Incoming Call Overlay -->
        <div id="incoming-call-modal" class="modal-overlay hidden">
            <div class="call-card glass-card">
                <div class="caller-avatar pulsing">?</div>
                <h3 class="call-type">Incoming Call...</h3>
                <div class="call-actions-row">
                    <button id="decline-call-btn" class="call-action decline">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                    <button id="accept-call-btn" class="call-action accept">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Hidden elements to maintain app.js compatibility -->
        <div id="random-call-controls" style="display:none">
          <!-- Moved to header -->
        </div>
        <!-- Active Call Overlay UI -->
        <!-- Call Overlay (FaceTime Style) -->
        <div id="call-overlay" class="call-overlay hidden">
            <!-- Main Video (Remote) -->
            <video id="remote-video" autoplay playsinline class="remote-view"></video>
            
            <!-- Connection Status -->
            <div id="call-status" class="call-status">
                <div class="status-dot"></div>
                <span id="call-status-text">Connecting...</span>
            </div>

            <!-- Draggable Local Video (PiP) -->
            <div id="local-video-container" class="local-view-container">
                 <video id="local-video" autoplay muted playsinline class="local-view"></video>
            </div>

            <!-- Controls (Floating Glass Bar) -->
            <div id="call-controls" class="call-controls-bar glass-panel-floating">
                <button id="mute-audio-btn" class="control-btn ios-btn" title="Mute Audio">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                </button>
                <button id="mute-video-btn" class="control-btn ios-btn" title="Stop Video">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                </button>
                <button id="flip-camera-btn" class="control-btn ios-btn" title="Flip Camera">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 10c0-4.418-3.582-8-8-8s-8 3.582-8 8c0 2.025.75 3.876 2 5.316"></path><path d="M20 14c0 4.418-3.582 8-8 8s-8-3.582-8-8c0-2.025.75-3.876 2-5.316"></path><polyline points="20 10 23 10 23 7"></polyline><polyline points="4 14 1 14 1 17"></polyline></svg>
                </button>
                 <button id="end-call-btn" class="control-btn ios-btn danger-fill">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><path d="M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"></path></svg>
                </button>
            </div>
        </div>
        
        <!-- File Input for Media -->
        <input type="file" id="media-input" accept="image/*,video/*" style="display:none">

        <!-- Report Modal -->
        <div id="report-modal" class="modal-overlay hidden">
             <div class="modal-card glass-card">
                <h3>Report User</h3>
                <p>Please select a reason. The entire chat log and IP data will be sent to moderation.</p>
                <select id="report-reason" class="glass-input">
                    <option value="spam">Spam / Bot</option>
                    <option value="harassment">Harassment</option>
                    <option value="inappropriate">Inappropriate Content</option>
                    <option value="csam">Illegal Content (CSAM)</option>
                    <option value="other">Other</option>
                </select>
                <div class="modal-actions">
                    <button id="cancel-report-btn" class="modal-btn secondary">Cancel</button>
                    <button id="confirm-report-btn" class="modal-btn warning">Report</button>
                </div>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
    <script>
        // Simple clock for status bar
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('status-time').textContent = timeString;
        }
        setInterval(updateTime, 1000);
        updateTime();
    </script>
</body>
</html>
